extends ../layouts/layout

block content
  h1= title

  .d-flex.justify-content-end.mb-4.align-items-center
    // Dropdown for genres
    form(action="/movies", method="GET", class="me-2")
      .input-group
        label.input-group-text(for="genre-select") Genre
        select#genre-select.form-select(name="genre" onchange="this.form.submit()")
          option(value="") All Genres
          each genre in genres
            option(value=genre.category_id, selected=genre.category_id == selectedGenre)= genre.name

    // Search form
    form(action="/movies", method="GET", class="d-flex")
      input(
        type="search",
        name="search",
        class="form-control me-2",
        placeholder="Search movies...",
        aria-label="Search",
        value=searchQuery || ''
      )
      button(class="btn btn-outline-success", type="submit") Search

  // Improved movie display
  if movies.length > 0
    .container-fluid
      .row.row-cols-1.row-cols-sm-2.row-cols-md-3.row-cols-lg-4.g-4
        each movie in movies
          .col
            .card.h-100.shadow-sm
              a(href=`/movies/${movie.film_id}`)
                img.card-img-top(
                  src=movie.imageUrl ? movie.imageUrl : "/images/filmfoto.jpg",
                  alt=movie.title,
                  style="height: 300px; object-fit: cover;"
                )
              .card-body.d-flex.flex-column.text-center
                h5.card-title.text-truncate= movie.title
  else
    .alert.alert-info.text-center(role="alert")
      h4.alert-heading No movies found!
      p Try a different search query.

  // Pagination, now with First and Last buttons
  if totalPages > 1
    nav.mt-4
      ul.pagination.justify-content-center
        // First page button
        li.page-item(class=(currentPage === 1 ? 'disabled' : ''))
          a.page-link(href=`/movies?page=1${searchQuery ? '&search=' + searchQuery : ''}${selectedGenre ? '&genre=' + selectedGenre : ''}`) First
        
        // Previous button
        li.page-item(class=(currentPage === 1 ? 'disabled' : ''))
          a.page-link(href=`/movies?page=${currentPage - 1}${searchQuery ? '&search=' + searchQuery : ''}${selectedGenre ? '&genre=' + selectedGenre : ''}`) Previous

        each num in pagesToShow
          li.page-item(class=(num === currentPage ? 'active' : ''))
            a.page-link(href=`/movies?page=${num}${searchQuery ? '&search=' + searchQuery : ''}${selectedGenre ? '&genre=' + selectedGenre : ''}`)= num

        // Next button
        li.page-item(class=(currentPage === totalPages ? 'disabled' : ''))
          a.page-link(href=`/movies?page=${currentPage + 1}${searchQuery ? '&search=' + searchQuery : ''}${selectedGenre ? '&genre=' + selectedGenre : ''}`) Next
          
        // Last page button
        li.page-item(class=(currentPage === totalPages ? 'disabled' : ''))
          a.page-link(href=`/movies?page=${totalPages}${searchQuery ? '&search=' + searchQuery : ''}${selectedGenre ? '&genre=' + selectedGenre : ''}`) Last